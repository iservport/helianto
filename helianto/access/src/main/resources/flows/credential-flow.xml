<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE flow PUBLIC "-//SPRING//DTD WEBFLOW 1.0//EN"
	"http://www.springframework.org/dtd/spring-webflow-1.0.dtd">

<flow start-state="resolveSupervisor">
	
	<action-state id="resolveSupervisor">
		<action bean="credentialFormAction"/>
		<transition on="success" to="credForm.view"/>
		<transition on="error" to="noSupervisor"/>
	</action-state>

    <view-state id="credForm.view" view="credForm">
		<entry-actions>
			<action bean="credentialFormAction" method="setupForm"/>
		</entry-actions>
		<transition on="cancel" to="endCredential"/>
        <transition on="save" to="credSave.view">
			<action bean="credentialFormAction" method="bindAndValidate">
				<property name="validatorMethod"  value="validateEmail"/>
			</action>
	    </transition>
    </view-state>

	<action-state id="checkCredential">
		<action bean="credentialFormAction"/>
		<transition on="success" to="credSave.view"/>
		<transition on="error" to="credForm.view"/>
	</action-state>

    <view-state id="credSave.view" view="credSave">
		<transition on="cancel" to="endCredential"/>
		<transition on="back" to="credForm.view"/>
		<transition on="finish" to="finishCredential"/>
    </view-state>
	
    <action-state id="finishCredential">
        <action bean="credentialFormAction"/>
        <transition on="success" to="sendCredential"/>
        <transition on="error" to="credSave.view"/>
    </action-state>
	
    <action-state id="sendCredential">
        <action bean="credentialFormAction"/>
        <transition on="success" to="emailSent.view"/>
        <transition on="error" to="noEmail.view"/>
    </action-state>
	
    <view-state id="emailSent.view" view="emailSent">
		<transition on="end" to="endCredential"/>
    </view-state>
	
    <view-state id="noEmail.view" view="noEmail">
		<transition on="cancel" to="endCredential"/>
		<transition on="restart" to="credForm.view"/>
		<transition on="retry" to="sendCredential"/>
    </view-state>
	
	<end-state id="endCredential" />
	
	<end-state id="noSupervisor" />
	
</flow>

